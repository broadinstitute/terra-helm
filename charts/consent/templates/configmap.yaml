apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-configmap
  labels:
{{ include "consent.labels" . | indent 4 }}
data:
  consent.yaml: |
{{ include "consent.config.yaml" . | indent 4 }}
  site.conf: |
{{ include "consent.site.conf" . | indent 4 }}
  prometheusJmx.yaml: |
{{ include "consent.config.prometheusJmx" . | indent 4 }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-sqlproxy-env
  annotations:
    # Used by liquibase-migration
    argocd.argoproj.io/sync-wave: "-1"
  labels:
{{ include "consent.labels" . | indent 4 }}
data:
  CLOUDSQL_CREDENTIAL_FILE: /etc/service-account.json
  GOOGLE_PROJECT: {{ .Values.googleProject }}
  CLOUDSQL_ZONE: {{ .Values.googleProjectZone }}
  CLOUDSQL_INSTANCE: {{ .Values.cloudSqlInstance }}
  CLOUDSQL_MAXCONNS: '300'
  PORT: '5432'
