{{/*
We always create this particular secret, even if it would be empty, because the grafana container
in the subchart will always try to read it.
*/}}
apiVersion: secrets-manager.tuenti.io/v1alpha1
kind: SecretDefinition
metadata:
  name: {{ .Values.global.name }}-container-env
  labels:
    {{- include "grafana.labels" . | nindent 4 }}
spec:
  name: {{ .Values.global.name }}-container-env
  keysMap:
    {{- range .Values.secrets.containerEnv }}
    {{ .envVar | required "envVar is required for each containerEnv entry" }}:
      path: {{ .vaultPath | required "vaultPath is required for each containerEnv entry" }}
      key: {{ .vaultKey | required "vaultKey is required for each containerEnv entry" }}
      encoding: {{ .sourceEncoding | default "text" }}
    {{- end }}
