{{- if .Values.migration.enabled }}
apiVersion: secrets-manager.tuenti.io/v1alpha1
kind: SecretDefinition
metadata:
  name: rawls-migration-secretdef
  labels: {{- include "rawls.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/hook: PreSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation,HookSucceeded
    argocd.argoproj.io/sync-wave: "-1"
spec:
  name: rawls-sql-secrets
  keysMap:
    db-username:
      key: {{ .Values.vault.migration.dbUsernameKey }}
      path: {{ required "A valid vault.migration.path is required" .Values.vault.migration.path }}
      encoding: text
    db-password:
      key: {{ .Values.vault.migration.dbPasswordKey }}
      path: {{ required "A valid vault.migration.path is required" .Values.vault.migration.path }}
      encoding: text
{{- end -}}
