#
#
#   Autoscaling defaults and global configuration
#
#


# -- (number) Default number of runners to always allocate for a given repository
defaultMinReplicas: 3

# -- (number) Default nmaximum number of runners to allocate for a given repository (autoscales)
defaultMaxReplicas: 6

# -- (number) Overrides .defaultMinReplicas on weekends
defaultWeekendMinReplicas: 1

# -- (string) Weekend start time, recurs weekly
weekendStart: "2021-05-01T00:00:00+09:00"

# -- (string) Weekend end time, recurs weekly
weekendEnd: "2021-05-03T00:00:00+09:00"


#
#
#   Runner defaults and global configuration
#
#


# -- (object) Default runner metadata and spec overrides, see
# https://github.com/actions-runner-controller/actions-runner-controller#additional-tweaks
runnerDefaults:
  metadata:
  spec:

# -- (object) Lists/configures "shortcuts" to metadata/spec configurations
# for different docker configurations
dockerConfigs:
  
  # 'privilegedDockerInDocker' INSECURELY uses a privileged container to run
  # docker-in-docker via internal dockerd
  # - https://github.com/actions-runner-controller/actions-runner-controller#runner-with-dind
  privilegedDockerInDocker:
    metadata:
    spec:
      dockerEnabled: false
      dockerdWithinRunnerContainer: true
  
  # 'privilegedSidecar' INSECURELY uses a privileged sidecar container to run
  # docker-out-of-docker
  # - https://github.com/actions-runner-controller/actions-runner-controller#additional-tweaks
  privilegedSidecar:
    metadata:
    spec:
      dockerEnabled: true
      dockerdWithinRunnerContainer: false
  
  # 'none' provides no docker support whatsoever
  # - https://github.com/actions-runner-controller/actions-runner-controller#additional-tweaks
  none:
    metadata:
    spec:
      dockerEnabled: false
      dockerdWithinRunnerContainer: false

# -- (string) Name of a key on .dockerConfigs to use for docker configuration
defaultDockerConfig: privilegedDockerInDocker


#
#
#   Per-runner configuration, overriding any of the above
#
#


# -- (list) Sets of runners to create
runners:
    # (string) required; used in K8s resource names
  - name: example
    # (string) required; should be organization/repository
    repository: broadinstitute/example-repo
    # (number) optional; overrides .defaultMinReplicas if provided
    minReplicas: 2
    # (number) optional; overrides .defaultMaxReplicas if provided
    maxReplicas: 4
    # (number) optional; overrides .defaultWeekendMinReplicas if provided
    weekendMinReplicas: 1
    # (string) optional; overrides .defaultDockerConfig if provided
    dockerConfig: none
    # (object) optional; overrides .runnerDefaults and .dockerConfigs[dockerConfig] if provided
    configOverrides:
      # e.g.
      metadata:
        annotations:
          my-annotation: "foo"
      spec:
        resources:
          limits:
            cpu: "8.0"
            memory: "32Gi"
          requests:
            cpu: "4.0"
            memory: "16Gi"
