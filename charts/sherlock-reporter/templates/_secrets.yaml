{{- define "sherlock-reporter.secret" -}}
{{- if .Values.sherlock.enabled }}
{{- $appName := .Values.sherlock.appName | default .Release.Name -}}
{{- $labelRef := .Values.sherlock.labelRef | default (printf "%s.labels" $appName) -}}
{{- $vaultPathPrefix := .Values.sherlock.vault.pathPrefix | default "secret/suitable/sherlock/prod" -}}
apiVersion: secrets-manager.tuenti.io/v1alpha1
kind: SecretDefinition
metadata:
  name: {{ $appName }}-sherlock-client-credentials
  labels: {{- include $labelRef . | nindent 4 }}
spec:
  name: {{ $appName }}-sherlock-client-credentials
  keysMap:
    client-sa.json:
      path: {{ $vaultPathPrefix }}/client/sa
      encoding: base64
      key: key
    audience:
      path: {{ $vaultPathPrefix }}/iap
      key: client_id
{{- end -}}
{{- end -}}


