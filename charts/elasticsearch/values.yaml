# Set default values on chart from elastic.co
name: elasticsearch

vault:
  pathPrefix:

elasticsearch:

  image: "docker.io/broadinstitute/elasticsearch"
  imageTag: 5.4.0_6

  keystore:
    - secretName: elasticsearch-gcs-sa
      items:
      - key: gcs.client.default.credentials_file
        path: gcs.client.default.credentials_file

  podSecurityPolicy:
    create: true
    spec:
      privileged: true
      fsGroup:
        rule: RunAsAny
      runAsUser:
        rule: RunAsAny
      seLinux:
        rule: RunAsAny
      supplementalGroups:
        rule: RunAsAny
      volumes:
        - secret
        - configMap
        - persistentVolumeClaim
        - emptyDir

  rbac:
    create: true
  
  service:
    type: LoadBalancer
    loadBalancerIP: null
  # same as GCE VMS
  esJavaOpts: "-Xms3500m -Xmx3500m"

  volumeClaimTemplate:
    accessModes: [ "ReadWriteOnce" ]
    storageClassName: "terra-ssd"
    resources:
      requests:
        storage: 200Gi
  
  persistence:
    annotations:
      bio.terra/snapshot-policy: terra-snapshot-policy

  #set resources to be same as GCEs
  resources:
    requests:
      cpu: 2
      memory: 8Gi
    limits:
      cpu: 2
      memory: 8Gi

  esConfig:
    elasticsearch.yml: |
      http:
        cors:
          enabled: true
          allow-origin: '*'
      xpack:
        graph:
          enabled: false
        ml:
          enabled: false
        monitoring:
          enabled: false
        security:
          enabled: false
        watcher:
          enabled: false
    